<!DOCTYPE html>
<html>
<head>
  <title>Gutter Histogram Analysis</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: system-ui; max-width: 1800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
    h1, h2, h3 { color: #333; }
    .page-section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .chart-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
    .chart-container { height: 300px; }
    .chart-container-tall { height: 400px; }
    .stats-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 15px 0; }
    .stat-box { background: #f5f5f5; padding: 15px; border-radius: 4px; text-align: center; }
    .stat-value { font-size: 24px; font-weight: bold; color: #333; }
    .stat-label { font-size: 12px; color: #666; margin-top: 5px; }
    .thumbnail { max-width: 600px; border: 1px solid #ddd; }
    .legend { display: flex; gap: 20px; flex-wrap: wrap; margin: 10px 0; font-size: 14px; }
    .legend-item { display: flex; align-items: center; gap: 5px; }
    .legend-color { width: 20px; height: 10px; border-radius: 2px; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
  </style>
</head>
<body>
  <h1>Gutter Histogram Analysis</h1>

  <div class="page-section">
    <h2>Summary - Darkest Band Detection</h2>
    <table>
      <tr>
        <th>Page</th>
        <th>Dimensions</th>
        <th>By Mean</th>
        <th>By Min (Peak Dark)</th>
        <th>By P10</th>
        <th>By Median</th>
      </tr>
      
    </table>
  </div>

  

  <script>
    // Load chart data from JSON file
    fetch('chart-data.json')
      .then(r => r.json())
      .then(results => {
        renderCharts(results);
      })
      .catch(err => {
        console.error('Failed to load chart data:', err);
        document.body.innerHTML += '<p style="color:red">Error loading chart data. Run from a web server (http://localhost:3000).</p>';
      });

    function renderCharts(results) {
    results.forEach((r, idx) => {
      // Profile chart
      const profileCtx = document.getElementById('profile-' + idx).getContext('2d');
      const labels = r.columns.map(c => c.x);

      new Chart(profileCtx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: 'Mean', data: r.columns.map(c => c.mean), borderColor: 'rgba(255,99,132,0.8)', borderWidth: 2, pointRadius: 0, fill: false },
            { label: 'Min (Peak Dark)', data: r.columns.map(c => c.min), borderColor: 'rgba(54,162,235,0.8)', borderWidth: 2, pointRadius: 0, fill: false },
            { label: 'P10', data: r.columns.map(c => c.p10), borderColor: 'rgba(75,192,192,0.8)', borderWidth: 2, pointRadius: 0, fill: false },
            { label: 'Median', data: r.columns.map(c => c.median), borderColor: 'rgba(153,102,255,0.8)', borderWidth: 2, pointRadius: 0, fill: false },
            { label: 'StdDev', data: r.columns.map(c => c.stdDev), borderColor: 'rgba(255,159,64,0.5)', borderWidth: 1, pointRadius: 0, fill: false, yAxisID: 'y2' }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            title: { display: true, text: 'Brightness by Column Position' },
            annotation: {
              annotations: {
                centerRegion: {
                  type: 'box',
                  xMin: 35, xMax: 65,
                  backgroundColor: 'rgba(255,255,0,0.1)',
                  borderWidth: 0
                }
              }
            }
          },
          scales: {
            x: { title: { display: true, text: 'Position (%)' }, ticks: { maxTicksLimit: 20 } },
            y: { title: { display: true, text: 'Brightness (0=black)' }, min: 0, max: 255 },
            y2: { title: { display: true, text: 'Std Dev' }, position: 'right', min: 0, max: 100, grid: { drawOnChartArea: false } }
          }
        }
      });

      // Strip histogram (separate)
      const histCtx = document.getElementById('hist-' + idx).getContext('2d');
      const binLabels = Array.from({length: 64}, (_, i) => i * 4); // Downsampled to 64 bins

      new Chart(histCtx, {
        type: 'bar',
        data: {
          labels: binLabels,
          datasets: [
            { label: 'Left (10-25%)', data: r.strips.left.histogramPercent, backgroundColor: 'rgba(255,99,132,0.5)', barPercentage: 1, categoryPercentage: 1 },
            { label: 'Center (40-60%)', data: r.strips.center.histogramPercent, backgroundColor: 'rgba(54,162,235,0.5)', barPercentage: 1, categoryPercentage: 1 },
            { label: 'Right (75-90%)', data: r.strips.right.histogramPercent, backgroundColor: 'rgba(75,192,192,0.5)', barPercentage: 1, categoryPercentage: 1 }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { title: { display: true, text: 'Brightness Histogram by Region' } },
          scales: {
            x: { title: { display: true, text: 'Brightness (0=black, 255=white)' }, ticks: { maxTicksLimit: 20 } },
            y: { title: { display: true, text: 'Frequency %' } }
          }
        }
      });

      // Overlay histogram (line)
      const histOverlayCtx = document.getElementById('hist-overlay-' + idx).getContext('2d');

      new Chart(histOverlayCtx, {
        type: 'line',
        data: {
          labels: binLabels,
          datasets: [
            { label: 'Left', data: r.strips.left.histogramPercent, borderColor: 'rgb(255,99,132)', borderWidth: 2, pointRadius: 0, fill: false },
            { label: 'Center', data: r.strips.center.histogramPercent, borderColor: 'rgb(54,162,235)', borderWidth: 2, pointRadius: 0, fill: false },
            { label: 'Right', data: r.strips.right.histogramPercent, borderColor: 'rgb(75,192,192)', borderWidth: 2, pointRadius: 0, fill: false }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { title: { display: true, text: 'Histogram Overlay' } },
          scales: {
            x: { title: { display: true, text: 'Brightness' }, ticks: { maxTicksLimit: 20 } },
            y: { title: { display: true, text: 'Frequency %' } }
          }
        }
      });
    });
    } // end renderCharts
  </script>
</body>
</html>