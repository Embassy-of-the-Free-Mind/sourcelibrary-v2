<!DOCTYPE html>
<html>
<head>
  <title>Gutter Analysis</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: system-ui; max-width: 1400px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
    .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
    .chart-container { height: 350px; margin: 20px 0; }
    .thumbnails { display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0; }
    .thumbnails img { height: 200px; border: 1px solid #ddd; }
    .thumbnails-with-split { display: flex; gap: 15px; flex-wrap: wrap; margin: 20px 0; }
    .thumb-wrapper { position: relative; display: inline-block; }
    .thumb-wrapper img { height: 250px; border: 1px solid #ddd; display: block; }
    .split-line { position: absolute; top: 0; bottom: 25px; width: 3px; transform: translateX(-50%); opacity: 0.9; }
    .thumb-label { text-align: center; padding: 4px; font-size: 12px; font-weight: bold; background: #4caf50; color: white; }
    .thumb-label.warning { background: #ff9800; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  </style>
</head>
<body>
  <h1>Gutter Analysis</h1>

  <div class="card">
    <h2>Summary</h2>
    <table>
      <tr>
        <th>Page</th>
        <th>Dimensions</th>
        <th>Aspect</th>
        <th>Split Position</th>
        <th>Score</th>
        <th>Dark Run</th>
        <th>Transitions</th>
        <th>Text?</th>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>5</strong></td>
        <td>3430x2910</td>
        <td>1.179</td>
        <td><strong>51.4%</strong> (514)</td>
        <td>65.5</td>
        <td>82.2%</td>
        <td>16</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>10</strong></td>
        <td>3535x2911</td>
        <td>1.214</td>
        <td><strong>48.9%</strong> (489)</td>
        <td>59.5</td>
        <td>64.0%</td>
        <td>52</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>20</strong></td>
        <td>3562x2909</td>
        <td>1.224</td>
        <td><strong>48.5%</strong> (485)</td>
        <td>73.2</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>40</strong></td>
        <td>3596x2902</td>
        <td>1.239</td>
        <td><strong>48.4%</strong> (484)</td>
        <td>73.5</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>60</strong></td>
        <td>3600x2900</td>
        <td>1.241</td>
        <td><strong>48.2%</strong> (482)</td>
        <td>77.0</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>80</strong></td>
        <td>3621x2904</td>
        <td>1.247</td>
        <td><strong>49.6%</strong> (496)</td>
        <td>78.7</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>100</strong></td>
        <td>3622x2908</td>
        <td>1.246</td>
        <td><strong>48.9%</strong> (489)</td>
        <td>78.4</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>120</strong></td>
        <td>3646x2901</td>
        <td>1.257</td>
        <td><strong>50.5%</strong> (505)</td>
        <td>78.1</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>140</strong></td>
        <td>3655x2897</td>
        <td>1.262</td>
        <td><strong>50.3%</strong> (503)</td>
        <td>77.2</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>160</strong></td>
        <td>3646x2900</td>
        <td>1.257</td>
        <td><strong>50.7%</strong> (507)</td>
        <td>79.3</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>180</strong></td>
        <td>3640x2900</td>
        <td>1.255</td>
        <td><strong>50.9%</strong> (509)</td>
        <td>77.5</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>200</strong></td>
        <td>3633x2907</td>
        <td>1.250</td>
        <td><strong>51.5%</strong> (515)</td>
        <td>79.9</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>220</strong></td>
        <td>3620x2908</td>
        <td>1.245</td>
        <td><strong>51.8%</strong> (518)</td>
        <td>80.3</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
      <tr style="background: #e8f5e9">
        <td><strong>240</strong></td>
        <td>3609x2899</td>
        <td>1.245</td>
        <td><strong>52.4%</strong> (524)</td>
        <td>77.0</td>
        <td>100.0%</td>
        <td>0</td>
        <td>âœ“ NO</td>
      </tr>
      
    </table>
  </div>

  <div class="card">
    <h2>Detected Split Lines</h2>
    <p>Red line = detected gutter position. Green = high confidence, Orange = text warning.</p>
    <div class="thumbnails-with-split">
      
        <div class="thumb-wrapper">
          <img src="page-5-thumb.jpg" title="Page 5">
          <div class="split-line" style="left: 51.4%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P5: 51.4% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-10-thumb.jpg" title="Page 10">
          <div class="split-line" style="left: 48.9%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P10: 48.9% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-20-thumb.jpg" title="Page 20">
          <div class="split-line" style="left: 48.5%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P20: 48.5% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-40-thumb.jpg" title="Page 40">
          <div class="split-line" style="left: 48.4%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P40: 48.4% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-60-thumb.jpg" title="Page 60">
          <div class="split-line" style="left: 48.2%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P60: 48.2% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-80-thumb.jpg" title="Page 80">
          <div class="split-line" style="left: 49.6%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P80: 49.6% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-100-thumb.jpg" title="Page 100">
          <div class="split-line" style="left: 48.9%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P100: 48.9% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-120-thumb.jpg" title="Page 120">
          <div class="split-line" style="left: 50.5%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P120: 50.5% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-140-thumb.jpg" title="Page 140">
          <div class="split-line" style="left: 50.3%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P140: 50.3% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-160-thumb.jpg" title="Page 160">
          <div class="split-line" style="left: 50.7%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P160: 50.7% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-180-thumb.jpg" title="Page 180">
          <div class="split-line" style="left: 50.9%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P180: 50.9% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-200-thumb.jpg" title="Page 200">
          <div class="split-line" style="left: 51.5%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P200: 51.5% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-220-thumb.jpg" title="Page 220">
          <div class="split-line" style="left: 51.8%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P220: 51.8% âœ“
          </div>
        </div>
      
        <div class="thumb-wrapper">
          <img src="page-240-thumb.jpg" title="Page 240">
          <div class="split-line" style="left: 52.4%; background: #4caf50;"></div>
          <div class="thumb-label ">
            P240: 52.4% âœ“
          </div>
        </div>
      
    </div>
  </div>

  <div class="card">
    <h2>Average Brightness (Mean)</h2>
    <p>X: position across image (%), Y: mean brightness of column (0=black, 255=white)</p>
    <div class="chart-container">
      <canvas id="meanChart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>Peak Darkness (Min)</h2>
    <p>X: position (%), Y: darkest pixel in each column</p>
    <div class="chart-container">
      <canvas id="minChart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>Peak Lightness (Max)</h2>
    <p>X: position (%), Y: lightest pixel in each column</p>
    <div class="chart-container">
      <canvas id="maxChart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>10th Percentile (P10)</h2>
    <p>X: position (%), Y: 10% of pixels are darker than this value</p>
    <div class="chart-container">
      <canvas id="p10Chart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>25th Percentile (P25)</h2>
    <p>X: position (%), Y: 25% of pixels are darker than this value</p>
    <div class="chart-container">
      <canvas id="p25Chart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>Median (P50)</h2>
    <p>X: position (%), Y: median brightness of column</p>
    <div class="chart-container">
      <canvas id="medianChart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>75th Percentile (P75)</h2>
    <p>X: position (%), Y: 75% of pixels are darker than this value</p>
    <div class="chart-container">
      <canvas id="p75Chart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>90th Percentile (P90)</h2>
    <p>X: position (%), Y: 90% of pixels are darker than this value</p>
    <div class="chart-container">
      <canvas id="p90Chart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>Standard Deviation</h2>
    <p>X: position (%), Y: std dev of pixel values in column (higher = more variance)</p>
    <div class="chart-container">
      <canvas id="stdDevChart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>Range (Max - Min)</h2>
    <p>X: position (%), Y: difference between lightest and darkest pixel in column</p>
    <div class="chart-container">
      <canvas id="rangeChart"></canvas>
    </div>
  </div>

  <div class="card" style="background: #ffe8e8;">
    <h2>ðŸŽ¯ Dark Pixel % (< 180)</h2>
    <p>X: position (%), Y: percentage of pixels in column darker than 180. <b>Gutter = high % consistently dark</b></p>
    <div class="chart-container">
      <canvas id="darkPercentChart"></canvas>
    </div>
  </div>

  <div class="card" style="background: #ffe8e8;">
    <h2>ðŸŽ¯ Very Dark Pixel % (< 120)</h2>
    <p>X: position (%), Y: percentage of pixels in column darker than 120</p>
    <div class="chart-container">
      <canvas id="veryDarkPercentChart"></canvas>
    </div>
  </div>

  <div class="card" style="background: #e8ffe8;">
    <h2>ðŸŽ¯ Max Dark Run Length</h2>
    <p>X: position (%), Y: longest consecutive dark run as % of column height. <b>Gutter = long continuous dark, Text = short runs with gaps</b></p>
    <div class="chart-container">
      <canvas id="maxDarkRunChart"></canvas>
    </div>
  </div>

  <div class="card" style="background: #e8ffe8;">
    <h2>ðŸŽ¯ Dark/Light Transitions</h2>
    <p>X: position (%), Y: number of transitions between dark and light. <b>Text = many transitions, Gutter = few transitions</b></p>
    <div class="chart-container">
      <canvas id="transitionsChart"></canvas>
    </div>
  </div>

  <div class="card" style="background: #e8e8ff;">
    <h2>ðŸŽ¯ Dark Pixel Consistency (Std Dev)</h2>
    <p>X: position (%), Y: std dev of darkest 25% pixels. <b>Low = uniform darkness (gutter), High = varied (text)</b></p>
    <div class="chart-container">
      <canvas id="darkStdDevChart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>Center Region Histogram</h2>
    <p>Brightness distribution in center 20% of each image</p>
    <div class="chart-container">
      <canvas id="histChart"></canvas>
    </div>
  </div>

  <script>
    fetch('profiles.json')
      .then(r => r.json())
      .then(data => {
        const colors = ['#e74c3c', '#3498db', '#2ecc71', '#9b59b6', '#f39c12', '#1abc9c', '#e91e63'];
        const labels = data[0].profile.map(p => p.x);

        function createChart(canvasId, metric, title, yMin = 0, yMax = 255) {
          new Chart(document.getElementById(canvasId), {
            type: 'line',
            data: {
              labels,
              datasets: data.map((d, i) => ({
                label: 'Page ' + d.page,
                data: d.profile.map(p => p[metric]),
                borderColor: colors[i % colors.length],
                borderWidth: 2,
                pointRadius: 0,
                fill: false
              }))
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { position: 'top' } },
              scales: {
                x: { title: { display: true, text: 'Position (%)' } },
                y: { title: { display: true, text: title }, min: yMin, max: yMax }
              }
            }
          });
        }

        // Create all charts
        createChart('meanChart', 'mean', 'Brightness (0-255)');
        createChart('minChart', 'min', 'Brightness (0-255)');
        createChart('maxChart', 'max', 'Brightness (0-255)');
        createChart('p10Chart', 'p10', 'Brightness (0-255)');
        createChart('p25Chart', 'p25', 'Brightness (0-255)');
        createChart('medianChart', 'median', 'Brightness (0-255)');
        createChart('p75Chart', 'p75', 'Brightness (0-255)');
        createChart('p90Chart', 'p90', 'Brightness (0-255)');
        createChart('stdDevChart', 'stdDev', 'Std Dev', 0, 100);
        createChart('rangeChart', 'range', 'Range (max-min)', 0, 255);

        // New gutter-detection charts
        createChart('darkPercentChart', 'darkPercent', '% Dark Pixels', 0, 100);
        createChart('veryDarkPercentChart', 'veryDarkPercent', '% Very Dark', 0, 50);
        createChart('maxDarkRunChart', 'maxDarkRun', '% of Height', 0, 100);
        createChart('transitionsChart', 'transitions', '# Transitions', 0, null);
        createChart('darkStdDevChart', 'darkStdDev', 'Std Dev', 0, 50);

        // Histogram chart
        new Chart(document.getElementById('histChart'), {
          type: 'line',
          data: {
            labels: Array.from({length: 64}, (_, i) => i * 4),
            datasets: data.map((d, i) => ({
              label: 'Page ' + d.page,
              data: d.histogram,
              borderColor: colors[i % colors.length],
              borderWidth: 2,
              pointRadius: 0,
              fill: false
            }))
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: {
              x: { title: { display: true, text: 'Brightness (0-255)' } },
              y: { title: { display: true, text: 'Frequency (%)' } }
            }
          }
        });
      });
  </script>
</body>
</html>